---

title: celverapi


keywords: fastai
sidebar: home_sidebar

summary: "Library that allows the user to forecast multipletime Timeseries, parallel, using multiprocessing "
description: "Library that allows the user to forecast multipletime Timeseries, parallel, using multiprocessing "
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install celverapi</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this example we are going to use a DataFrame from 4 diferent grocery stores. 
The idea is to Forecast various models, from every single store, simultaneously</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">celverapi.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">celverapi.main</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;Data/example.parquet&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>store_nbr</th>
      <th>family</th>
      <th>sales</th>
      <th>onpromotion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01</td>
      <td>6</td>
      <td>GROCERY I</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-01</td>
      <td>7</td>
      <td>GROCERY I</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-01</td>
      <td>8</td>
      <td>GROCERY I</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-01</td>
      <td>9</td>
      <td>GROCERY I</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-02</td>
      <td>6</td>
      <td>GROCERY I</td>
      <td>5535.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2013-01-02</td>
      <td>7</td>
      <td>GROCERY I</td>
      <td>4172.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2013-01-02</td>
      <td>8</td>
      <td>GROCERY I</td>
      <td>5277.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2013-01-02</td>
      <td>9</td>
      <td>GROCERY I</td>
      <td>7718.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2013-01-03</td>
      <td>6</td>
      <td>GROCERY I</td>
      <td>4040.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2013-01-03</td>
      <td>7</td>
      <td>GROCERY I</td>
      <td>3279.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the function unique_dataframe_values(), we are going to create a list of DataFrames from every unique ID value in the Main DataFrame. 
In this case, we need a DataFrame from every Store.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_of_DataFrames</span> <span class="o">=</span> <span class="n">unique_dataframe_values</span><span class="p">(</span><span class="s1">&#39;store_nbr&#39;</span><span class="p">)</span>
<span class="n">list_of_DataFrames</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[            date  store_nbr     family   sales  onpromotion
 0     2013-01-01          6  GROCERY I     0.0          0.0
 4     2013-01-02          6  GROCERY I  5535.0          0.0
 8     2013-01-03          6  GROCERY I  4040.0          0.0
 12    2013-01-04          6  GROCERY I  3314.0          0.0
 16    2013-01-05          6  GROCERY I  4857.0          0.0
 ...          ...        ...        ...     ...          ...
 6716  2017-08-11          6  GROCERY I  4466.0        776.0
 6720  2017-08-12          6  GROCERY I  4027.0        770.0
 6724  2017-08-13          6  GROCERY I  5481.0        817.0
 6728  2017-08-14          6  GROCERY I  4142.0        773.0
 6732  2017-08-15          6  GROCERY I  4334.0        779.0
 
 [1684 rows x 5 columns],
             date  store_nbr     family   sales  onpromotion
 1     2013-01-01          7  GROCERY I     0.0          0.0
 5     2013-01-02          7  GROCERY I  4172.0          0.0
 9     2013-01-03          7  GROCERY I  3279.0          0.0
 13    2013-01-04          7  GROCERY I  2681.0          0.0
 17    2013-01-05          7  GROCERY I  2662.0          0.0
 ...          ...        ...        ...     ...          ...
 6717  2017-08-11          7  GROCERY I  3146.0        695.0
 6721  2017-08-12          7  GROCERY I  2851.0        723.0
 6725  2017-08-13          7  GROCERY I  2864.0        675.0
 6729  2017-08-14          7  GROCERY I  3872.0        744.0
 6733  2017-08-15          7  GROCERY I  3678.0        737.0
 
 [1684 rows x 5 columns],
             date  store_nbr     family   sales  onpromotion
 2     2013-01-01          8  GROCERY I     0.0          0.0
 6     2013-01-02          8  GROCERY I  5277.0          0.0
 10    2013-01-03          8  GROCERY I  3783.0          0.0
 14    2013-01-04          8  GROCERY I  3481.0          0.0
 18    2013-01-05          8  GROCERY I  4857.0          0.0
 ...          ...        ...        ...     ...          ...
 6718  2017-08-11          8  GROCERY I  4318.0        801.0
 6722  2017-08-12          8  GROCERY I  4734.0        814.0
 6726  2017-08-13          8  GROCERY I  5050.0        842.0
 6730  2017-08-14          8  GROCERY I  4354.0        807.0
 6734  2017-08-15          8  GROCERY I  4035.0        786.0
 
 [1684 rows x 5 columns],
             date  store_nbr     family     sales  onpromotion
 3     2013-01-01          9  GROCERY I     0.000          0.0
 7     2013-01-02          9  GROCERY I  7718.000          0.0
 11    2013-01-03          9  GROCERY I  4547.000          0.0
 15    2013-01-04          9  GROCERY I  3564.000          0.0
 19    2013-01-05          9  GROCERY I  5951.000          0.0
 ...          ...        ...        ...       ...          ...
 6719  2017-08-11          9  GROCERY I  5882.578        784.0
 6723  2017-08-12          9  GROCERY I  6686.109        804.0
 6727  2017-08-13          9  GROCERY I  6711.156        800.0
 6731  2017-08-14          9  GROCERY I  5860.789        773.0
 6735  2017-08-15          9  GROCERY I  6630.383        780.0
 
 [1684 rows x 5 columns]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once we have a list with the DataFrames that we want to work with, we are going to proceed splitting them into a Train and Test DataFrame.
In this case the Train DF is going to be from the Start Date until the 31-07-2017.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_of_trained_df</span><span class="p">,</span> <span class="n">list_of_tested</span> <span class="o">=</span> <span class="n">split_into_train_test_dataframe</span><span class="p">(</span><span class="n">list_of_DataFrames</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;2017-08-01&quot;</span><span class="p">)</span>
<span class="n">list_of_trained_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[            date  store_nbr     family   sales  onpromotion
 0     2013-01-01          6  GROCERY I     0.0          0.0
 4     2013-01-02          6  GROCERY I  5535.0          0.0
 8     2013-01-03          6  GROCERY I  4040.0          0.0
 12    2013-01-04          6  GROCERY I  3314.0          0.0
 16    2013-01-05          6  GROCERY I  4857.0          0.0
 ...          ...        ...        ...     ...          ...
 6656  2017-07-27          6  GROCERY I  3820.0        765.0
 6660  2017-07-28          6  GROCERY I  4602.0        807.0
 6664  2017-07-29          6  GROCERY I  6050.0        817.0
 6668  2017-07-30          6  GROCERY I  6664.0        840.0
 6672  2017-07-31          6  GROCERY I  5237.0        806.0
 
 [1669 rows x 5 columns],
             date  store_nbr     family   sales  onpromotion
 1     2013-01-01          7  GROCERY I     0.0          0.0
 5     2013-01-02          7  GROCERY I  4172.0          0.0
 9     2013-01-03          7  GROCERY I  3279.0          0.0
 13    2013-01-04          7  GROCERY I  2681.0          0.0
 17    2013-01-05          7  GROCERY I  2662.0          0.0
 ...          ...        ...        ...     ...          ...
 6657  2017-07-27          7  GROCERY I  3552.0        682.0
 6661  2017-07-28          7  GROCERY I  3930.0        721.0
 6665  2017-07-29          7  GROCERY I  3320.0        704.0
 6669  2017-07-30          7  GROCERY I  3776.0        711.0
 6673  2017-07-31          7  GROCERY I  4401.0        754.0
 
 [1669 rows x 5 columns],
             date  store_nbr     family   sales  onpromotion
 2     2013-01-01          8  GROCERY I     0.0          0.0
 6     2013-01-02          8  GROCERY I  5277.0          0.0
 10    2013-01-03          8  GROCERY I  3783.0          0.0
 14    2013-01-04          8  GROCERY I  3481.0          0.0
 18    2013-01-05          8  GROCERY I  4857.0          0.0
 ...          ...        ...        ...     ...          ...
 6658  2017-07-27          8  GROCERY I  3778.0        765.0
 6662  2017-07-28          8  GROCERY I  4913.0        816.0
 6666  2017-07-29          8  GROCERY I  5971.0        856.0
 6670  2017-07-30          8  GROCERY I  5962.0        850.0
 6674  2017-07-31          8  GROCERY I  4865.0        831.0
 
 [1669 rows x 5 columns],
             date  store_nbr     family     sales  onpromotion
 3     2013-01-01          9  GROCERY I     0.000          0.0
 7     2013-01-02          9  GROCERY I  7718.000          0.0
 11    2013-01-03          9  GROCERY I  4547.000          0.0
 15    2013-01-04          9  GROCERY I  3564.000          0.0
 19    2013-01-05          9  GROCERY I  5951.000          0.0
 ...          ...        ...        ...       ...          ...
 6659  2017-07-27          9  GROCERY I  5172.547        714.0
 6663  2017-07-28          9  GROCERY I  5379.938        758.0
 6667  2017-07-29          9  GROCERY I  7861.719        832.0
 6671  2017-07-30          9  GROCERY I  8069.242        813.0
 6675  2017-07-31          9  GROCERY I  7676.711        794.0
 
 [1669 rows x 5 columns]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After that, we will convert this DataFrames into TimeSeries objects and save them in their respective lists.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trained_timeseries</span><span class="p">,</span> <span class="n">valed_timeseries</span> <span class="o">=</span> <span class="n">converting_dataframes_into_objects</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;store_nbr&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">)</span>
<span class="n">trained_timeseries</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[          date  store_nbr     family   sales  onpromotion
 0   2013-01-01          6  GROCERY I     0.0          0.0
 4   2013-01-02          6  GROCERY I  5535.0          0.0
 8   2013-01-03          6  GROCERY I  4040.0          0.0
 12  2013-01-04          6  GROCERY I  3314.0          0.0
 16  2013-01-05          6  GROCERY I  4857.0          0.0,
           date  store_nbr     family   sales  onpromotion
 1   2013-01-01          7  GROCERY I     0.0          0.0
 5   2013-01-02          7  GROCERY I  4172.0          0.0
 9   2013-01-03          7  GROCERY I  3279.0          0.0
 13  2013-01-04          7  GROCERY I  2681.0          0.0
 17  2013-01-05          7  GROCERY I  2662.0          0.0,
           date  store_nbr     family   sales  onpromotion
 2   2013-01-01          8  GROCERY I     0.0          0.0
 6   2013-01-02          8  GROCERY I  5277.0          0.0
 10  2013-01-03          8  GROCERY I  3783.0          0.0
 14  2013-01-04          8  GROCERY I  3481.0          0.0
 18  2013-01-05          8  GROCERY I  4857.0          0.0,
           date  store_nbr     family   sales  onpromotion
 3   2013-01-01          9  GROCERY I     0.0          0.0
 7   2013-01-02          9  GROCERY I  7718.0          0.0
 11  2013-01-03          9  GROCERY I  4547.0          0.0
 15  2013-01-04          9  GROCERY I  3564.0          0.0
 19  2013-01-05          9  GROCERY I  5951.0          0.0]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The last part of the preparation, is to create a dictionary that maps the ID from the TimeSeries object with the ForecastingTask Object.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dict_of_forecasting_tasks</span> <span class="o">=</span> <span class="n">creating_forecasting_task_dict</span><span class="p">(</span><span class="n">trained_timeseries</span><span class="p">,</span> <span class="n">valed_timeseries</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">dict_of_forecasting_tasks</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{6: &lt;celverapi.core.ForecastingTask at 0x148d64d8400&gt;,
 7: &lt;celverapi.core.ForecastingTask at 0x148d64d8460&gt;,
 8: &lt;celverapi.core.ForecastingTask at 0x148d64d8880&gt;,
 9: &lt;celverapi.core.ForecastingTask at 0x148d64d8790&gt;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To Forecast this TimeSeries, we need to call the forecast() function, where we need to pass a list of the models that we want to use and the Forecasting Task dictionary.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">final_result</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">([</span><span class="s1">&#39;ets&#39;</span><span class="p">,</span> <span class="s1">&#39;naive&#39;</span><span class="p">,</span> <span class="s1">&#39;trend&#39;</span><span class="p">],</span> <span class="n">dict_of_forecasting_tasks</span><span class="p">)</span>

<span class="n">final_result</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Qty</th>
      <th>ID</th>
      <th>Date</th>
      <th>Model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8344</th>
      <td>5234.366950</td>
      <td>6</td>
      <td>2017-08-01</td>
      <td>ETS-Model</td>
    </tr>
    <tr>
      <th>8348</th>
      <td>5234.366950</td>
      <td>6</td>
      <td>2017-08-02</td>
      <td>ETS-Model</td>
    </tr>
    <tr>
      <th>8352</th>
      <td>5234.366950</td>
      <td>6</td>
      <td>2017-08-03</td>
      <td>ETS-Model</td>
    </tr>
    <tr>
      <th>8356</th>
      <td>5234.366950</td>
      <td>6</td>
      <td>2017-08-04</td>
      <td>ETS-Model</td>
    </tr>
    <tr>
      <th>8360</th>
      <td>5234.366950</td>
      <td>6</td>
      <td>2017-08-05</td>
      <td>ETS-Model</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8387</th>
      <td>17776.977872</td>
      <td>9</td>
      <td>2017-08-11</td>
      <td>Trend Model</td>
    </tr>
    <tr>
      <th>8391</th>
      <td>17783.141263</td>
      <td>9</td>
      <td>2017-08-12</td>
      <td>Trend Model</td>
    </tr>
    <tr>
      <th>8395</th>
      <td>17789.304655</td>
      <td>9</td>
      <td>2017-08-13</td>
      <td>Trend Model</td>
    </tr>
    <tr>
      <th>8399</th>
      <td>17795.468047</td>
      <td>9</td>
      <td>2017-08-14</td>
      <td>Trend Model</td>
    </tr>
    <tr>
      <th>8403</th>
      <td>17801.631439</td>
      <td>9</td>
      <td>2017-08-15</td>
      <td>Trend Model</td>
    </tr>
  </tbody>
</table>
<p>180 rows × 4 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>


